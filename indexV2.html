<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ðŸŽ² Carnet Cannes 2026</title>
<link rel="manifest" href="/manifest.json">
<script>
if('serviceWorker' in navigator){navigator.serviceWorker.register('/sw.js');}
</script>
<style>
:root {
  --red: #E8282A; --gold: #F5C842; --dark: #1A1A1A; --card: #242424;
  --text: #F0EDE8; --muted: #888; --border: #3A3A3A;
  --green: #4CAF82; --orange: #F5833A;
}
* { box-sizing: border-box; margin:0; padding:0; -webkit-tap-highlight-color: transparent; }
body { background: var(--dark); color: var(--text); font-family: 'DM Sans', system-ui, sans-serif; min-height:100vh; }

.header { background: var(--red); padding:14px 18px; display:flex; align-items:center; justify-content:space-between; box-shadow:0 4px 20px rgba(232,40,42,0.4); position:sticky; top:0; z-index:100; }
.header-title { font-weight:900; font-size:20px; letter-spacing:2px; color:#fff; font-variant:small-caps; }
.header-sub { font-size:11px; color:rgba(255,255,255,0.7); letter-spacing:1px; text-transform:uppercase; margin-top:2px; }
.header-count { background: var(--dark); color: var(--gold); font-weight:900; font-size:24px; padding:4px 12px; border-radius:8px; }

.tabs { display:flex; background:#1e1e1e; border-bottom:1px solid var(--border); }
.tab { flex:1; padding:12px 4px; text-align:center; font-size:12px; font-weight:700; color:var(--muted); cursor:pointer; border-bottom:3px solid transparent; text-transform:uppercase; letter-spacing:0.5px; transition:all 0.2s; }
.tab.active { color: var(--gold); border-bottom-color: var(--gold); background: rgba(245,200,66,0.05); }

.page { display:none; } .page.active { display:block; }

.form-wrap { padding:16px; display:flex; flex-direction:column; gap:14px; }
.field-label { font-size:11px; text-transform:uppercase; letter-spacing:1px; color:var(--muted); margin-bottom:5px; font-weight:700; }
input[type=text], textarea { width:100%; background:var(--card); border:1px solid var(--border); border-radius:10px; color:var(--text); font-family:inherit; font-size:15px; padding:12px 14px; outline:none; transition:border-color 0.2s; }
input[type=text]:focus, textarea:focus { border-color: var(--gold); }
textarea { resize:none; min-height:70px; }

.stars { display:flex; gap:6px; }
.star { font-size:30px; cursor:pointer; opacity:0.2; color:var(--gold); transition:all 0.15s; user-select:none; }
.star.on { opacity:1; transform:scale(1.1); }

.pills { display:flex; gap:8px; flex-wrap:wrap; }
.pill { padding:8px 16px; border-radius:20px; font-size:13px; font-weight:700; border:2px solid var(--border); cursor:pointer; transition:all 0.2s; color:var(--muted); }
.pill.buy.on { background:var(--green); border-color:var(--green); color:#fff; }
.pill.retry.on { background:var(--orange); border-color:var(--orange); color:#fff; }
.pill.skip.on { background:#555; border-color:#555; color:#fff; }

.day-btns { display:flex; gap:8px; }
.day-btn { flex:1; padding:10px 4px; border-radius:10px; border:2px solid var(--border); background:none; color:var(--muted); font-family:inherit; font-size:13px; font-weight:700; cursor:pointer; transition:all 0.2s; }
.day-btn.on { border-color:var(--red); background: rgba(232,40,42,0.15); color: var(--text); }

.photo-zone { display:flex; flex-direction:column; gap:10px; }
.photo-add-btn { display:flex; align-items:center; justify-content:center; gap:8px; background: var(--card); border:2px dashed var(--border); border-radius:12px; padding:14px; cursor:pointer; color:var(--muted); font-size:14px; font-weight:600; transition:all 0.2s; }
.photo-add-btn:active { border-color: var(--gold); color: var(--gold); }
.photo-input { display:none; }
.photo-thumbs { display:flex; flex-wrap:wrap; gap:8px; }
.photo-thumb-wrap { position:relative; width:80px; height:80px; }
.photo-thumb { width:80px; height:80px; object-fit:cover; border-radius:10px; border:2px solid var(--border); }
.photo-del { position:absolute; top:-6px; right:-6px; background: var(--red); color:#fff; border:none; border-radius:50%; width:22px; height:22px; font-size:12px; cursor:pointer; display:flex; align-items:center; justify-content:center; font-weight:700; }

.btn-save { background: var(--gold); color: var(--dark); border:none; border-radius:12px; padding:16px; font-weight:900; font-size:18px; letter-spacing:2px; cursor:pointer; width:100%; transition:all 0.2s; font-variant:small-caps; }
.btn-save.ok { background: var(--green); color:#fff; }
.btn-save:active { transform:scale(0.97); }

.filter-bar { display:flex; gap:8px; padding:12px 16px 0; flex-wrap:wrap; }
.chip { padding:6px 12px; border-radius:20px; font-size:12px; font-weight:700; border:1.5px solid var(--border); color:var(--muted); cursor:pointer; text-transform:uppercase; letter-spacing:0.5px; transition:all 0.2s; }
.chip.on { border-color: var(--gold); color: var(--gold); background: rgba(245,200,66,0.08); }

.list-wrap { padding:12px 16px; display:flex; flex-direction:column; gap:10px; }
.game-card { background:var(--card); border-radius:14px; padding:14px 16px; border-left:4px solid var(--border); animation:fadeIn 0.3s ease; }
.game-card.buy { border-left-color: var(--green); }
.game-card.retry { border-left-color: var(--orange); }
.game-card.skip { border-left-color:#555; }
@keyframes fadeIn { from {opacity:0; transform:translateY(6px);} to {opacity:1; transform:none;} }

.gc-top { display:flex; justify-content:space-between; align-items:flex-start; gap:8px; }
.gc-name { font-weight:700; font-size:16px; line-height:1.2; }
.gc-editor { font-size:12px; color:var(--muted); margin-top:2px; }
.gc-stars { color:var(--gold); font-size:14px; white-space:nowrap; }
.gc-del { font-size:18px; cursor:pointer; opacity:0.4; padding:2px 4px; flex-shrink:0; }
.gc-meta { display:flex; gap:8px; margin-top:6px; flex-wrap:wrap; align-items:center; }
.badge { font-size:11px; padding:3px 8px; border-radius:6px; font-weight:700; text-transform:uppercase; }
.badge.day { background: rgba(232,40,42,0.2); color:#ff8080; }
.badge.buy { background: rgba(76,175,130,0.2); color:var(--green); }
.badge.retry { background: rgba(245,131,58,0.2); color:var(--orange); }
.badge.skip { background: rgba(100,100,100,0.2); color:#888; }
.gc-price { font-size:12px; color:var(--gold); font-weight:700; }
.gc-note { margin-top:8px; font-size:13px; color:#aaa; line-height:1.4; font-style:italic; }
.gc-photos { display:flex; gap:6px; flex-wrap:wrap; margin-top:10px; }
.gc-photo { width:70px; height:70px; object-fit:cover; border-radius:8px; border:1.5px solid var(--border); cursor:pointer; transition:transform 0.2s; }
.gc-photo:active { transform:scale(0.95); }

.lightbox { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.92); z-index:999; align-items:center; justify-content:center; flex-direction:column; gap:16px; }
.lightbox.open { display:flex; }
.lightbox img { max-width:95vw; max-height:80vh; border-radius:12px; object-fit:contain; }
.lightbox-close { color:#fff; font-size:32px; cursor:pointer; position:absolute; top:20px; right:24px; opacity:0.7; }

.stats-wrap { padding:16px; display:flex; flex-direction:column; gap:12px; }
.stat-row { background:var(--card); border-radius:14px; padding:16px 20px; display:flex; justify-content:space-between; align-items:center; }
.stat-label { font-size:13px; color:var(--muted); text-transform:uppercase; letter-spacing:0.5px; font-weight:700; }
.stat-val { font-weight:900; font-size:32px; }
.stat-val.gold { color:var(--gold); }
.stat-val.green { color:var(--green); }
.stat-val.orange { color:var(--orange); }
.buy-list { background:var(--card); border-radius:14px; padding:16px; }
.buy-list-title { font-weight:900; font-size:18px; color:var(--gold); margin-bottom:12px; font-variant:small-caps; letter-spacing:1px; }
.buy-item { display:flex; justify-content:space-between; align-items:center; padding:10px 0; border-bottom:1px solid var(--border); }
.buy-item:last-child { border-bottom:none; }
.buy-item-name { font-size:14px; font-weight:500; }
.buy-item-price { font-size:13px; color:var(--gold); font-weight:700; }

.empty { text-align:center; color:var(--muted); padding:40px 20px; font-size:14px; line-height:1.8; }
.empty-icon { font-size:40px; margin-bottom:8px; }

.storage-bar { margin:0 16px; padding:8px 12px; background:rgba(245,200,66,0.1); border:1px solid rgba(245,200,66,0.3); border-radius:8px; font-size:12px; color:var(--gold); display:none; }
.storage-bar.visible { display:block; }
</style>
</head>
<body>

<div class="header">
  <div>
    <div class="header-title">ðŸŽ² Cannes 2026</div>
    <div class="header-sub">26 fÃ©v â€” 1er mars</div>
  </div>
  <div class="header-count" id="totalCount">0</div>
</div>

<div class="tabs">
  <div class="tab active" onclick="showTab('add')">ï¼‹ Ajouter</div>
  <div class="tab" onclick="showTab('list')">ðŸ“‹ Liste</div>
  <div class="tab" onclick="showTab('stats')">ðŸ“Š Bilan</div>
</div>

<!-- LIGHTBOX -->
<div class="lightbox" id="lightbox" onclick="closeLightbox()">
  <span class="lightbox-close">âœ•</span>
  <img id="lightboxImg" src="" alt="">
</div>

<!-- ADD PAGE -->
<div class="page active" id="page-add">
  <div class="form-wrap">
    <div>
      <div class="field-label">Nom du jeu *</div>
      <input type="text" id="gameName" placeholder="Ex: Flip 7, Rebirthâ€¦">
    </div>
    <div>
      <div class="field-label">Ã‰diteur</div>
      <input type="text" id="gameEditor" placeholder="Ex: Repos Productionâ€¦">
    </div>
    <div>
      <div class="field-label">Jour</div>
      <div class="day-btns">
        <button class="day-btn on" onclick="selectDay(this,'Jeu 26')">Jeu 26</button>
        <button class="day-btn" onclick="selectDay(this,'Ven 27')">Ven 27</button>
        <button class="day-btn" onclick="selectDay(this,'Sam 28')">Sam 28</button>
        <button class="day-btn" onclick="selectDay(this,'Dim 1')">Dim 1</button>
      </div>
    </div>
    <div>
      <div class="field-label">Note</div>
      <div class="stars" id="starRating">
        <span class="star" onclick="setStars(1)">â˜…</span>
        <span class="star" onclick="setStars(2)">â˜…</span>
        <span class="star" onclick="setStars(3)">â˜…</span>
        <span class="star" onclick="setStars(4)">â˜…</span>
        <span class="star" onclick="setStars(5)">â˜…</span>
      </div>
    </div>
    <div>
      <div class="field-label">DÃ©cision</div>
      <div class="pills">
        <div class="pill buy" onclick="selectDecision('buy',this)">ðŸ›’ Acheter</div>
        <div class="pill retry" onclick="selectDecision('retry',this)">ðŸ”„ Retester</div>
        <div class="pill skip" onclick="selectDecision('skip',this)">âœ— Non merci</div>
      </div>
    </div>
    <div>
      <div class="field-label">Prix repÃ©rÃ©</div>
      <input type="text" id="gamePrice" placeholder="Ex: 35 â‚¬">
    </div>
    <div>
      <div class="field-label">Photos</div>
      <div class="photo-zone">
        <div class="photo-thumbs" id="newPhotos"></div>
        <label class="photo-add-btn">
          <span style="font-size:20px">ðŸ“·</span> Ajouter une photo
          <input type="file" accept="image/*" capture="environment" class="photo-input" id="photoInput" onchange="addPhoto(event)" multiple>
        </label>
      </div>
    </div>
    <div>
      <div class="field-label">Notes / impressions</div>
      <textarea id="gameNote" placeholder="MÃ©canique, thÃ¨me, durÃ©e de partieâ€¦"></textarea>
    </div>
    <!-- BACKUP / RESTORE -->
    <div style="display:flex;gap:8px">
      <button class="btn-save" onclick="exportData()">ðŸ’¾ Export backup</button>
      <label class="btn-save" style="text-align:center; cursor:pointer">
        ðŸ“‚ Import backup
        <input type="file" accept="application/json" onchange="importData(this.files[0])" hidden>
      </label>
    </div>
    <button class="btn-save" id="saveBtn" onclick="saveGame()">ENREGISTRER LE JEU</button>
  </div>
</div>

<!-- LIST PAGE -->
<div class="page" id="page-list">
  <div class="filter-bar">
    <div class="chip on" onclick="setFilter('all',this)">Tous</div>
    <div class="chip" onclick="setFilter('buy',this)">ðŸ›’ Acheter</div>
    <div class="chip" onclick="setFilter('retry',this)">ðŸ”„ Retester</div>
    <div class="chip" onclick="setFilter('skip',this)">âœ— Non</div>
    <div class="chip" onclick="setFilter('photo',this)">ðŸ“· Avec photos</div>
  </div>
  <div class="storage-bar" id="storageBar"></div>
  <div class="list-wrap" id="gameList"></div>
</div>

<!-- STATS PAGE -->
<div class="page" id="page-stats">
  <div class="stats-wrap" id="statsWrap"></div>
</div>

<script>
const DB_KEY = 'cannes2026_v3';
let games = [], currentStars=0, currentDecision='', currentDay='Jeu 26', currentFilter='all', pendingPhotos=[];

// LOAD
try { games = JSON.parse(localStorage.getItem(DB_KEY) || '[]'); } catch(e){ games=[]; }
document.getElementById('totalCount').textContent = games.length;

// STORAGE CHECK
function save() {
  try { localStorage.setItem(DB_KEY, JSON.stringify(games)); document.getElementById('totalCount').textContent = games.length; checkStorage(); } 
  catch(e){ alert('âš ï¸ Stockage plein !'); }
}
function checkStorage() {
  try {
    const used = new Blob(Object.values(localStorage)).size;
    const mb = (used/1024/1024).toFixed(1);
    const bar = document.getElementById('storageBar');
    bar.textContent = `Stockage local utilisÃ©: ${mb} Mo`;
    bar.classList.add('visible');
  } catch(e){ }
}

// TAB SWITCH
function showTab(tab) {
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelector('.tab[onclick*="'+tab+'"]').classList.add('active');
  document.getElementById('page-'+tab).classList.add('active');
  if(tab==='list') renderList();
  if(tab==='stats') renderStats();
}

// DAY PICKER
function selectDay(btn,day){ currentDay=day; btn.parentElement.querySelectorAll('button').forEach(b=>b.classList.remove('on')); btn.classList.add('on'); }

// STARS
function setStars(n){ currentStars=n; document.querySelectorAll('#starRating .star').forEach((s,i)=>s.classList.toggle('on',i<n)); }

// DECISION
function selectDecision(decision,el){ currentDecision=decision; el.parentElement.querySelectorAll('.pill').forEach(p=>p.classList.remove('on')); el.classList.add('on'); }

// PHOTOS
function addPhoto(e) {
  for(const file of e.target.files) {
    const reader = new FileReader();
    reader.onload = ev => { pendingPhotos.push(ev.target.result); renderNewPhotos(); }
    reader.readAsDataURL(file);
  }
}
function renderNewPhotos(){
  const wrap = document.getElementById('newPhotos'); wrap.innerHTML='';
  pendingPhotos.forEach((p,i)=>{
    const div = document.createElement('div'); div.className='photo-thumb-wrap';
    const img = document.createElement('img'); img.src=p; img.className='photo-thumb'; img.onclick=()=>openLightbox(p);
    const del = document.createElement('button'); del.className='photo-del'; del.textContent='Ã—'; del.onclick=(ev)=>{ev.stopPropagation(); pendingPhotos.splice(i,1); renderNewPhotos();};
    div.appendChild(img); div.appendChild(del); wrap.appendChild(div);
  });
}

// LIGHTBOX
function openLightbox(src){ const lb=document.getElementById('lightbox'); lb.classList.add('open'); document.getElementById('lightboxImg').src=src; }
function closeLightbox(){ document.getElementById('lightbox').classList.remove('open'); }

// SAVE GAME
function saveGame() {
  const name = document.getElementById('gameName').value.trim(); 
  if(!name){ alert('âš ï¸ Nom du jeu requis'); return; }
  const editor=document.getElementById('gameEditor').value.trim();
  const price=document.getElementById('gamePrice').value.trim();
  const note=document.getElementById('gameNote').value.trim();
  const newGame={ name, editor, day:currentDay, stars:currentStars, decision:currentDecision, price, note, photos:[...pendingPhotos] };
  games.push(newGame); pendingPhotos=[]; renderNewPhotos(); save();
  document.getElementById('gameName').value=''; document.getElementById('gameEditor').value=''; document.getElementById('gamePrice').value=''; document.getElementById('gameNote').value='';
  setStars(0); currentDecision=''; document.querySelectorAll('.pill').forEach(p=>p.classList.remove('on'));
  alert('âœ”ï¸ Jeu enregistrÃ© !');
}

// EXPORT / IMPORT
function exportData() {
  const blob = new Blob([JSON.stringify(games)], { type:'application/json' });
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='carnet-cannes-backup.json'; a.click();
}
function importData(file) {
  const reader = new FileReader();
  reader.onload = e => {
    try { games = JSON.parse(e.target.result); save(); location.reload(); } 
    catch(err){ alert('âš ï¸ Fichier invalide'); }
  };
  reader.readAsText(file);
}

// FILTER / LIST
function setFilter(f,el){
  currentFilter=f; document.querySelectorAll('.chip').forEach(c=>c.classList.remove('on')); el.classList.add('on'); renderList();
}
function renderList(){
  const wrap=document.getElementById('gameList'); wrap.innerHTML='';
  let filtered = games;
  if(currentFilter==='photo') filtered = games.filter(g=>g.photos?.length);
  else if(['buy','retry','skip'].includes(currentFilter)) filtered = games.filter(g=>g.decision===currentFilter);
  filtered.sort((a,b)=>a.day.localeCompare(b.day));
  if(!filtered.length){ wrap.innerHTML='<div class="empty"><div class="empty-icon">ðŸ“­</div>Aucun jeu trouvÃ©</div>'; return; }
  for(const g of filtered){
    const div=document.createElement('div'); div.className='game-card '+(g.decision||'');
    div.innerHTML=`
      <div class="gc-top">
        <div>
          <div class="gc-name">${g.name}</div>
          <div class="gc-editor">${g.editor||''}</div>
          <div class="gc-stars">${'â˜…'.repeat(g.stars)+'â˜†'.repeat(5-g.stars)}</div>
        </div>
        <div class="gc-del" onclick="if(confirm('Supprimer?')){games.splice(games.indexOf(g),1); save(); renderList();}">Ã—</div>
      </div>
      <div class="gc-meta">
        <div class="badge day">${g.day}</div>
        ${g.decision?`<div class="badge ${g.decision}">${g.decision==='buy'?'ðŸ›’ Acheter':g.decision==='retry'?'ðŸ”„ Retester':'âœ— Non'}</div>`:''}
        ${g.price?`<div class="gc-price">${g.price}</div>`:''}
      </div>
      ${g.note?`<div class="gc-note">${g.note}</div>`:''}
      ${g.photos?.length?`<div class="gc-photos">${g.photos.map(p=>`<img class="gc-photo" src="${p}" onclick="openLightbox('${p}')">`).join('')}</div>`:''}
    `;
    wrap.appendChild(div);
  }
}

// STATS
function renderStats(){
  const wrap=document.getElementById('statsWrap'); wrap.innerHTML='';
  const perDay={}; let withPhotos=0;
  for(const g of games){ perDay[g.day]=(perDay[g.day]||0)+1; if(g.photos?.length) withPhotos++; }
  wrap.innerHTML=`
    <div class="stat-row"><div class="stat-label">Jeux testÃ©s</div><div class="stat-val gold">${games.length}</div></div>
    <div class="stat-row"><div class="stat-label">Avec photos</div><div class="stat-val">${withPhotos}</div></div>
    <div class="stat-row"><div class="stat-label">Par jour</div>
      <div>${Object.entries(perDay).map(([d,n])=>`${d}: ${n} jeu${n>1?'x':''}`).join('<br>')}</div>
    </div>
  `;
}
</script>
</body>
</html>
